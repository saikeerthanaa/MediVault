{
  "title": "Frontend Data Flow - Step by Step",
  "description": "Exact fields extracted from API responses and displayed in the UI",
  
  "workflow": [
    {
      "step": 1,
      "name": "Upload Document",
      "api_endpoint": "POST /ai/process-document",
      "ui_fields": {
        "confidence_score": "response.confidence (displayed as %) ",
        "text_preview": "response.raw_text (first 500 chars)",
        "file_size": "file object size",
        "requires_review": "response.requires_review"
      },
      "frontend_state_keys": ["uploadedFile", "rawText", "ocrConfidence"]
    },
    {
      "step": 2,
      "name": "Normalize & Extract Entities",
      "api_endpoint": "POST /ai/normalize-and-extract",
      "request_fields": {
        "reviewed_text": "state.rawText (user-editable textarea)",
        "patient_verified": "true (hardcoded)",
        "ocr_confidence": "state.ocrConfidence"
      },
      "ui_fields": {
        "normalized_text": "response.entities.medications + response.entities.conditions + response.entities.allergies",
        "medications_list": "response.entities.medications[].name",
        "conditions_list": "response.entities.conditions[]",
        "allergies_list": "response.entities.allergies[]",
        "save_status": "Auto-saves via /ai/save-prescription"
      },
      "frontend_state_keys": ["extractedEntities", "prescriptionId"],
      "entities_structure": {
        "medications": [
          {
            "name": "e.g. Aspirin",
            "dosage": "500mg",
            "frequency": "Twice daily",
            "duration": "For 7 days",
            "route": "Oral",
            "schedule": "object with frequency_per_day, as_needed, duration_days"
          }
        ],
        "conditions": ["Hypertension", "Diabetes"],
        "allergies": ["Penicillin"],
        "lab_values": []
      }
    },
    {
      "step": 3,
      "name": "Check Drug Interactions (Optional)",
      "api_endpoint": "POST /ai/check-interaction (called for each med pair)",
      "request_fields": {
        "new_med": "medications[i].name",
        "current_meds": "[medications[j].name]"
      },
      "ui_fields": {
        "interaction_summary": "response.interactions[].summary",
        "interaction_severity": "response.interactions[].severity",
        "drug_pair": "medication names being checked"
      },
      "frontend_state_keys": ["interactionResults"],
      "display_logic": "Only show card if interactions.length > 0 AND severity != 'unknown'"
    },
    {
      "step": 4,
      "name": "Generate Voice Summary",
      "api_endpoint": "POST /ai/tts",
      "request_fields": {
        "text": "auto-generated summary from extractedEntities",
        "voice_id": "from dropdown (Joanna | Matthew | Raveesh | Aditi)"
      },
      "ui_fields": {
        "audio_player": "response (audio/mpeg bytes)",
        "summary_text": "medications + allergies + warnings formatted"
      },
      "frontend_state_keys": ["audioBlob"]
    },
    {
      "step": "Success",
      "name": "Prescription Saved",
      "api_endpoint": "POST /ai/save-prescription (auto-called in step 2)",
      "response_fields": {
        "prescription_id": "displayed in success screen",
        "medicines_saved": "count",
        "interactions": "warnings if any"
      },
      "ui_display": {
        "rx_id": "prescription_id",
        "medications_final": "list of saved medications",
        "success_message": "Custom message or auto-generated"
      }
    }
  ],
  
  "state_object": {
    "currentStep": "enum: upload | extract | interact | voice",
    "uploadedFile": "File object",
    "rawText": "string",
    "ocrConfidence": "number (0-100)",
    "extractedEntities": {
      "medications": "[{name, dosage, frequency, duration, route, schedule}]",
      "conditions": "[string]",
      "allergies": "[string]",
      "lab_values": "[]"
    },
    "prescriptionId": "number | null",
    "interactionResults": "{interactions: []}",
    "audioBlob": "Blob | null"
  },
  
  "frontend_endpoints_called": {
    "POST /ai/process-document": "File upload → raw text extraction",
    "POST /ai/normalize-and-extract": "Normalize text → extract entities",
    "POST /ai/save-prescription": "Auto-save to database (called after extraction)",
    "POST /ai/check-interaction": "Check med pairs (optional, manual button)",
    "POST /ai/tts": "Generate voice (optional, conditional button)"
  }
}
